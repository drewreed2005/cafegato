"pkg-config --exists libffi"
| pkg-config --libs libffi
=> "-lffi\n"
"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6   "
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib'
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib'
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: int main(int argc, char **argv)
4: {
5:   return !!argv[argc];
6: }
/* end */

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -lffi  "
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib'
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib'
ld: library not found for -lffi
clang-11: error: linker command failed with exit code 1 (use -v to see invocation)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: int main(int argc, char **argv)
4: {
5:   return !!argv[argc];
6: }
/* end */

package configuration for libffi is not found
have_header: checking for ffi.h... -------------------- no

"clang -E -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe  conftest.c -o conftest.i"
conftest.c:3:10: fatal error: 'ffi.h' file not found
#include <ffi.h>
         ^~~~~~~
1 error generated.
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <ffi.h>
/* end */

--------------------

find_header: checking for ffi.h in /usr/local/include,/usr/include/ffi,/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi,/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX.sdk/usr/include/ffi... -------------------- yes

"clang -E -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe  conftest.c -o conftest.i"
conftest.c:3:10: fatal error: 'ffi.h' file not found
#include <ffi.h>
         ^~~~~~~
1 error generated.
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <ffi.h>
/* end */

"clang -E -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe -I/usr/local/include conftest.c -o conftest.i"
conftest.c:3:10: fatal error: 'ffi.h' file not found
#include <ffi.h>
         ^~~~~~~
1 error generated.
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <ffi.h>
/* end */

"clang -E -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe -I/usr/include/ffi conftest.c -o conftest.i"
conftest.c:3:10: fatal error: 'ffi.h' file not found
#include <ffi.h>
         ^~~~~~~
1 error generated.
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <ffi.h>
/* end */

"clang -E -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi conftest.c -o conftest.i"
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: #include <ffi.h>
/* end */

--------------------

have_library: checking for ffi_prep_closure_loc() in -lffi... -------------------- no

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -lffi   "
In file included from conftest.c:3:
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:195:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_void;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:196:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:197:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:198:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type  ffi_type_uint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:199:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:200:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:201:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:202:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:203:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:204:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:205:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:206:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_pointer;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:209:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:215:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:216:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:218:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:280:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:286:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_ptrarray_to_raw (ffi_cif *cif, void **args, ffi_raw *raw);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:287:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_raw_to_ptrarray (ffi_cif *cif, ffi_raw *raw, void **args);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <ffi.h>
 4: 
 5: /*top*/
 6: extern int t(void);
 7: int main(int argc, char **argv)
 8: {
 9:   if (argc > 1000000) {
10:     int (* volatile tp)(void)=(int (*)(void))&t;
11:     printf("%d", (*tp)());
12:   }
13: 
14:   return !!argv[argc];
15: }
16: int t(void) { void ((*volatile p)()); p = (void ((*)()))ffi_prep_closure_loc; return !p; }
/* end */

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -lffi   "
In file included from conftest.c:3:
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:195:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_void;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:196:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:197:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:198:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type  ffi_type_uint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:199:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:200:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:201:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:202:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:203:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:204:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:205:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:206:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_pointer;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:209:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:215:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:216:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:218:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:280:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:286:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_ptrarray_to_raw (ffi_cif *cif, void **args, ffi_raw *raw);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:287:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_raw_to_ptrarray (ffi_cif *cif, ffi_raw *raw, void **args);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <ffi.h>
 4: 
 5: /*top*/
 6: extern int t(void);
 7: int main(int argc, char **argv)
 8: {
 9:   if (argc > 1000000) {
10:     int (* volatile tp)(void)=(int (*)(void))&t;
11:     printf("%d", (*tp)());
12:   }
13: 
14:   return !!argv[argc];
15: }
16: extern void ffi_prep_closure_loc();
17: int t(void) { ffi_prep_closure_loc(); return 0; }
/* end */

--------------------

have_library: checking for ffi_prep_closure_loc() in -llibffi... -------------------- no

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -llibffi   "
In file included from conftest.c:3:
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:195:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_void;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:196:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:197:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:198:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type  ffi_type_uint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:199:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:200:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:201:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:202:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:203:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:204:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:205:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:206:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_pointer;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:209:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:215:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:216:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:218:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:280:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:286:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_ptrarray_to_raw (ffi_cif *cif, void **args, ffi_raw *raw);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:287:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_raw_to_ptrarray (ffi_cif *cif, ffi_raw *raw, void **args);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <ffi.h>
 4: 
 5: /*top*/
 6: extern int t(void);
 7: int main(int argc, char **argv)
 8: {
 9:   if (argc > 1000000) {
10:     int (* volatile tp)(void)=(int (*)(void))&t;
11:     printf("%d", (*tp)());
12:   }
13: 
14:   return !!argv[argc];
15: }
16: int t(void) { void ((*volatile p)()); p = (void ((*)()))ffi_prep_closure_loc; return !p; }
/* end */

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -llibffi   "
In file included from conftest.c:3:
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:195:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_void;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:196:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:197:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:198:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type  ffi_type_uint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:199:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:200:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:201:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:202:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:203:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:204:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:205:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:206:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_pointer;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:209:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:215:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:216:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:218:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:280:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:286:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_ptrarray_to_raw (ffi_cif *cif, void **args, ffi_raw *raw);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:287:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_raw_to_ptrarray (ffi_cif *cif, ffi_raw *raw, void **args);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <ffi.h>
 4: 
 5: /*top*/
 6: extern int t(void);
 7: int main(int argc, char **argv)
 8: {
 9:   if (argc > 1000000) {
10:     int (* volatile tp)(void)=(int (*)(void))&t;
11:     printf("%d", (*tp)());
12:   }
13: 
14:   return !!argv[argc];
15: }
16: extern void ffi_prep_closure_loc();
17: int t(void) { ffi_prep_closure_loc(); return 0; }
/* end */

--------------------

have_library: checking for ffi_prep_closure_loc() in -llibffi-8... -------------------- no

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -llibffi-8   "
In file included from conftest.c:3:
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:195:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_void;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:196:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:197:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:198:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type  ffi_type_uint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:199:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:200:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:201:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:202:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:203:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:204:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:205:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:206:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_pointer;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:209:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:215:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:216:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:218:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:280:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:286:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_ptrarray_to_raw (ffi_cif *cif, void **args, ffi_raw *raw);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:287:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_raw_to_ptrarray (ffi_cif *cif, ffi_raw *raw, void **args);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <ffi.h>
 4: 
 5: /*top*/
 6: extern int t(void);
 7: int main(int argc, char **argv)
 8: {
 9:   if (argc > 1000000) {
10:     int (* volatile tp)(void)=(int (*)(void))&t;
11:     printf("%d", (*tp)());
12:   }
13: 
14:   return !!argv[argc];
15: }
16: int t(void) { void ((*volatile p)()); p = (void ((*)()))ffi_prep_closure_loc; return !p; }
/* end */

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -llibffi-8   "
In file included from conftest.c:3:
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:195:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_void;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:196:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:197:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint8;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:198:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type  ffi_type_uint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:199:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint16;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:200:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:201:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint32;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:202:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_uint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:203:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_sint64;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:204:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:205:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:206:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_pointer;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:209:1: error: expected ','
FFI_AVAILABLE_APPLE FFI_EXTERN ffi_type ffi_type_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:55:72: note: expanded from macro 'FFI_AVAILABLE_APPLE'
#define FFI_AVAILABLE_APPLE      API_AVAILABLE(macos(10.0), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                       ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:215:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_float;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:216:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_double;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:218:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_EXTERN ffi_type ffi_type_complex_longdouble;
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:280:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:286:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_ptrarray_to_raw (ffi_cif *cif, void **args, ffi_raw *raw);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:287:1: error: expected ','
FFI_AVAILABLE_APPLE_2019 FFI_API void ffi_raw_to_ptrarray (ffi_cif *cif, ffi_raw *raw, void **args);
^
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi/ffi.h:56:73: note: expanded from macro 'FFI_AVAILABLE_APPLE_2019'
#define FFI_AVAILABLE_APPLE_2019 API_AVAILABLE(macos(10.15), macCatalyst(13.0)) API_UNAVAILABLE(ios, tvos, watchos)
                                                                        ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
checked program was:
/* begin */
 1: #include "ruby.h"
 2: 
 3: #include <ffi.h>
 4: 
 5: /*top*/
 6: extern int t(void);
 7: int main(int argc, char **argv)
 8: {
 9:   if (argc > 1000000) {
10:     int (* volatile tp)(void)=(int (*)(void))&t;
11:     printf("%d", (*tp)());
12:   }
13: 
14:   return !!argv[argc];
15: }
16: extern void ffi_prep_closure_loc();
17: int t(void) { ffi_prep_closure_loc(); return 0; }
/* end */

--------------------

block in append_ldflags: checking for whether -Wl,--exclude-libs,ALL is accepted as LDFLAGS... -------------------- no

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -Wl,--exclude-libs,ALL  "
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib'
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib'
ld: unknown option: --exclude-libs
clang-11: error: linker command failed with exit code 1 (use -v to see invocation)
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: int main(int argc, char **argv)
4: {
5:   return !!argv[argc];
6: }
/* end */

--------------------

block in append_ldflags: checking for whether -pthread is accepted as LDFLAGS... -------------------- yes

"clang -o conftest -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/x86_64-darwin21 -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0/ruby/backward -I/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/include/ruby-2.7.0 -I. -I/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include/ffi -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE -D_DARWIN_UNLIMITED_SELECT -D_REENTRANT   -g -O2 -fno-common -pipe conftest.c  -L. -L/nix/store/5dbxm29kwz7pry5jydkzvnvavyd1mwbi-ruby-2.7.6/lib -L. -fstack-protector-strong -L/nix/store/zf3ffpyinidxy77gljdvl4092155cwds-gettext-0.21/lib -L/nix/store/70svxpvqqdnidg5ngixbrxcyidbkawlw-file-5.43/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib -L/nix/store/zhg64bz96ra0qsa22jqrvyghfyyvjfmi-libffi-3.4.4-dev/lib -L/nix/store/1lnn7d8lhx16m32cmrpv50f4fz4jm4hh-ncurses-6.3-p20220507-dev/lib -L/nix/store/k0zf4zmz5lamgjsamlbkidy1p0v3fpbw-readline-8.1p2-dev/lib -L/nix/store/vhqazccyw2q0k08w289qlmxvf7i705y3-zlib-1.2.13-dev/lib -L/nix/store/9n92xh0x9iw366973kyslfx4y8l553jp-openssl-1.1.1s-dev/lib -L/nix/store/gc6n5zygy424dsg90dz0hcfrms94cff1-gdbm-1.23/lib -L/nix/store/2cqyzan46bg6sz876r3812d0c7jva0na-libyaml-0.2.5/lib -L/nix/store/z1d2x7ybr06vi5czzr27vsd5j77sc6qw-libiconv-50/lib -L/nix/store/lzpckck82f8rfj6vvazfr7dsh6n0b1v0-objc4-709.1/lib -L/nix/store/i5kwgjf6bsj5hjh13bk9xqm93qci27jc-libunwind-35.3/lib -L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib -L/nix/store/dm35436lwr5dyk6izqpjrhv6w5gx9gxx-Libsystem-1238.60.2/lib     -lruby-2.7.6 -pthread  "
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-ruby-3.1.2/lib'
ld: warning: directory not found for option '-L/nix/store/eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee-clang-wrapper-11.1.0/resource-root/lib'
checked program was:
/* begin */
1: #include "ruby.h"
2: 
3: int main(int argc, char **argv)
4: {
5:   return !!argv[argc];
6: }
/* end */

--------------------

extconf.h is:
/* begin */
1: #ifndef EXTCONF_H
2: #define EXTCONF_H
3: #define HAVE_FFI_PREP_CIF_VAR 1
4: #define USE_INTERNAL_LIBFFI 1
5: #endif
/* end */

